<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow • eurobarometer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Workflow">
<meta property="og:description" content="eurobarometer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eurobarometer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create_tabels.html">Creating Variable and Values Tables</a>
    </li>
    <li>
      <a href="../articles/eurobarometer_class.html">The labelled_eurobarometer Class</a>
    </li>
    <li>
      <a href="../articles/harmonization.html">Survey Data Harmonization</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Working With Metadata</a>
    </li>
    <li>
      <a href="../articles/variable_names.html">Harmonizing Variable Names</a>
    </li>
    <li>
      <a href="../articles/vocabulary.html">Working With Vocabularies</a>
    </li>
    <li>
      <a href="../articles/workflow.html">Workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/antaldaniel/eurobarometer/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="workflow_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antaldaniel/eurobarometer/blob/master/vignettes/workflow.Rmd"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="hidden name"><code>workflow.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">eurobarometer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)</pre></body></html></div>
<p>At this point this workflow if purely hypothetical, the functions are not written, and they are not evaluated.</p>
<div id="acquiring-the-data-from-gesis" class="section level2">
<h2 class="hasAnchor">
<a href="#acquiring-the-data-from-gesis" class="anchor"></a>Acquiring the data from GESIS</h2>
<p>I do not see a lot of sense in automating this, because the new GESIS interface requires a lot of approvals and interaction. However, I think that the files should be in a single folder. Maybe this could be a <code><a href="https://rdrr.io/r/base/tempfile.html">tempdir()</a></code> but I am not very enthusiastic about it because it causes documentation issues.</p>
</div>
<div id="reading-in-the-files" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-in-the-files" class="anchor"></a>Reading in the files</h2>
<p>Working with native SPSS files is extremely slow, and I think it would make sense to first read and re-save them as .rds files or .rda files.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">import_file_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
<span class="st">'ZA7576_sample'</span>,<span class="st">'ZA6863_sample'</span>)

<span class="no">my_survey_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span> (
   <span class="no">import_file_names</span>, <span class="kw">.f</span> <span class="kw">=</span> <span class="st">'read_example_file'</span> )</pre></body></html></div>
</div>
<div id="analyse-the-metadata-in-the-surveys" class="section level2">
<h2 class="hasAnchor">
<a href="#analyse-the-metadata-in-the-surveys" class="anchor"></a>Analyse the metadata in the surveys</h2>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">my_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gesis_metadata_create.html">gesis_metadata_create</a></span>( <span class="no">my_survey_list</span> )
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">my_metadata</span>)
<span class="co">#&gt;  [1] "filename"             "qb"                   "var_name_orig"       </span>
<span class="co">#&gt;  [4] "var_label_orig"       "var_label_norm"       "var_name_suggested"  </span>
<span class="co">#&gt;  [7] "length_cat_range"     "length_na_range"      "length_total_range"  </span>
<span class="co">#&gt; [10] "n_categories"         "factor_levels"        "valid_range"         </span>
<span class="co">#&gt; [13] "na_levels"            "class_orig"           "conversion_suggested"</span></pre></body></html></div>
<p>The my_metadata table is rather large, so let’s review random samples from a few columns.</p>
<p>The variable names need to be harmonized, and you will get suggestions on how to do it. Only a very small subset of the entire table is shown here:</p>
<table class="table table table-striped table-hover table-condensed">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_name_orig
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_label_orig
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_name_suggested
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
isocntry
</td>
<td style="text-align:left;">
COUNTRY CODE - ISO 3166
</td>
<td style="text-align:left;">
country_code_iso_3166
</td>
</tr>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
p1
</td>
<td style="text-align:left;">
DATE OF INTERVIEW
</td>
<td style="text-align:left;">
date_of_interview
</td>
</tr>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
doi
</td>
<td style="text-align:left;">
DIGITAL OBJECT IDENTIFIER
</td>
<td style="text-align:left;">
doi
</td>
</tr>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
qa14_3
</td>
<td style="text-align:left;">
EUROPEAN CENTRAL BANK - TRUST
</td>
<td style="text-align:left;">
european_central_bank_trust
</td>
</tr>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
filename
</td>
<td style="text-align:left;">
filename
</td>
<td style="text-align:left;">
filename
</td>
</tr>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
d7
</td>
<td style="text-align:left;">
MARITAL STATUS
</td>
<td style="text-align:left;">
marital_status
</td>
</tr>
<tr>
<td style="text-align:left;">
ZA7576_sample
</td>
<td style="text-align:left;">
w1
</td>
<td style="text-align:left;">
WEIGHT RESULT FROM TARGET (REDRESSMENT)
</td>
<td style="text-align:left;">
weight_result_from_target_redressment
</td>
</tr>
</tbody>
</table>
<p>The metadata can help identifying questionnaire item types and it suggests conversion to R classes. Again, only a very small subset of the entire table is shown below:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">subset_metadata_1</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span> ( <span class="no">var_name_suggested</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span> () <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="kw">bootstrap_options</span> <span class="kw">=</span>
                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),
                  <span class="kw">fixed_thead</span> <span class="kw">=</span> <span class="no">T</span>,
                  <span class="kw">font_size</span> <span class="kw">=</span> <span class="fl">10</span> )</pre></body></html></div>
<table class="table table table-striped table-hover table-condensed">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_label_norm
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_name_suggested
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
conversion_suggested
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length_cat_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length_na_range
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
country_code_iso_3166
</td>
<td style="text-align:left;">
country_code_iso_3166
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
date_of_interview
</td>
<td style="text-align:left;">
date_of_interview
</td>
<td style="text-align:left;">
haven_labelled
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
digital_object_identifier
</td>
<td style="text-align:left;">
doi
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
european_central_bank_trust
</td>
<td style="text-align:left;">
european_central_bank_trust
</td>
<td style="text-align:left;">
harmonized_labelled
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
filename
</td>
<td style="text-align:left;">
filename
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
marital_status
</td>
<td style="text-align:left;">
marital_status
</td>
<td style="text-align:left;">
haven_labelled
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
weight_result_from_target_redressment
</td>
<td style="text-align:left;">
weight_result_from_target_redressment
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<table class="table table table-striped table-hover table-condensed">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
qb
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_name_orig
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var_name_suggested
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
conversion_suggested
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
doi
</td>
<td style="text-align:left;">
doi
</td>
<td style="text-align:left;">
character
</td>
</tr>
<tr>
<td style="text-align:left;">
id
</td>
<td style="text-align:left;">
filename
</td>
<td style="text-align:left;">
filename
</td>
<td style="text-align:left;">
character
</td>
</tr>
<tr>
<td style="text-align:left;">
metadata
</td>
<td style="text-align:left;">
isocntry
</td>
<td style="text-align:left;">
country_code_iso_3166
</td>
<td style="text-align:left;">
character
</td>
</tr>
<tr>
<td style="text-align:left;">
metadata
</td>
<td style="text-align:left;">
p1
</td>
<td style="text-align:left;">
date_of_interview
</td>
<td style="text-align:left;">
haven_labelled
</td>
</tr>
<tr>
<td style="text-align:left;">
socio-demography
</td>
<td style="text-align:left;">
d7
</td>
<td style="text-align:left;">
marital_status
</td>
<td style="text-align:left;">
haven_labelled
</td>
</tr>
<tr>
<td style="text-align:left;">
trust
</td>
<td style="text-align:left;">
qa14_3
</td>
<td style="text-align:left;">
european_central_bank_trust
</td>
<td style="text-align:left;">
harmonized_labelled
</td>
</tr>
<tr>
<td style="text-align:left;">
weights
</td>
<td style="text-align:left;">
w1
</td>
<td style="text-align:left;">
weight_result_from_target_redressment
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
</tbody>
</table>
<ul>
<li>The <code>id</code> groups serve only identification purposes, and will be used in the skeleton of the panel.</li>
<li>The <code>metadata</code> group relate to information about the responses. We include here the country ID because it determines the weight(s) to be used.</li>
<li>The <code>weigths</code> group shows the weights calculated by Kantar or GESIS.</li>
<li>The <code>socio-demography</code> group shows <strong>identified</strong> socio-demography variables for which <code>eurobarometer</code> provides a built-in harmonization tool. There may be other variables that the research would like to add into this group by overriding the <code>qb</code> value of certain question ids.</li>
<li>The <code>trust</code> group relates to a variable group covered by our example harmonization table <code>trust_table</code>.</li>
<li>The <code>not_identified</code> group contains variables for which we do not offer a full-scale built-in harmonization. However, some of our helper functions do help harmonizing these variables, too, but they require more manual programming work by the user.</li>
</ul>
</div>
<div id="creating-a-skeleton-panel" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-skeleton-panel" class="anchor"></a>Creating a skeleton panel</h2>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">## filter out the most basic and omnipresent id variables, and the</span>
<span class="co">## most basic weights, w1 and its projected version wex</span>

<span class="no">my_panel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/panel_create.html">panel_create</a></span> ( <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">my_survey_list</span>,
               <span class="co">## must be at least two, and one must be the uniqid</span>
               <span class="co">## of the file or row_id </span>
                          <span class="kw">id_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"uniqid"</span>, <span class="st">"doi"</span>)
               )

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">my_panel</span>)
<span class="co">#&gt; [1] "panel_id" "uniqid"   "doi"</span></pre></body></html></div>
<p>Let’s have a look at 6 randomly selected rows:</p>
<table class="table table table-striped table-hover table-condensed">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
panel_id
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
uniqid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
doi
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2601_350001116_doi_10_4232_1_12847
</td>
<td style="text-align:left;">
350001116
</td>
<td style="text-align:left;">
<a href="doi:10.4232/1.12847" class="uri">doi:10.4232/1.12847</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
5959_630001408_doi_10_4232_1_13393
</td>
<td style="text-align:left;">
630001408
</td>
<td style="text-align:left;">
<a href="doi:10.4232/1.13393" class="uri">doi:10.4232/1.13393</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1780_220000963_doi_10_4232_1_13393
</td>
<td style="text-align:left;">
220000963
</td>
<td style="text-align:left;">
<a href="doi:10.4232/1.13393" class="uri">doi:10.4232/1.13393</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
3603_390001333_doi_10_4232_1_12847
</td>
<td style="text-align:left;">
390001333
</td>
<td style="text-align:left;">
<a href="doi:10.4232/1.12847" class="uri">doi:10.4232/1.12847</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1865_220001241_doi_10_4232_1_13393
</td>
<td style="text-align:left;">
220001241
</td>
<td style="text-align:left;">
<a href="doi:10.4232/1.13393" class="uri">doi:10.4232/1.13393</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
3366_390000603_doi_10_4232_1_12847
</td>
<td style="text-align:left;">
390000603
</td>
<td style="text-align:left;">
<a href="doi:10.4232/1.12847" class="uri">doi:10.4232/1.12847</a>
</td>
</tr>
</tbody>
</table>
<p>This should return a very basic file for joining, a data.frame/tibble with * a truly unique id * id elements for joining in individual survey data, in this example, <code>uniqid</code> and <code>filename</code> must be present in all imported files. The filename was added by <code><a href="../reference/read_surveys.html">read_surveys()</a></code>.</p>
</div>
<div id="harmonizing-various-aspects-of-the-survey" class="section level2">
<h2 class="hasAnchor">
<a href="#harmonizing-various-aspects-of-the-survey" class="anchor"></a>Harmonizing various aspects of the survey</h2>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## The id's are all harmonized to character value, they are </span>
<span class="co">## not consistent in the original SPSS files. </span>
<span class="no">id_panel</span>        <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_qb_vars.html">harmonize_qb_vars</a></span>(
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">my_survey_list</span>,
  <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">my_metadata</span>,
  <span class="kw">id_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"uniqid"</span>, <span class="st">"doi"</span>),
  <span class="kw">question_block</span> <span class="kw">=</span> <span class="st">"id"</span>,
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"var_name_suggested"</span>,
  <span class="kw">conversion</span> <span class="kw">=</span> <span class="st">"conversion_suggested"</span> )

<span class="co">## Weights are harmonized to numeric.</span>
<span class="no">weight_panel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_qb_vars.html">harmonize_qb_vars</a></span>(
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">my_survey_list</span>,
  <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">my_metadata</span>,
  <span class="kw">question_block</span> <span class="kw">=</span> <span class="st">"weights"</span>,
  <span class="kw">id_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"uniqid"</span>, <span class="st">"doi"</span>),
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"var_name_suggested"</span>,
  <span class="kw">conversion</span> <span class="kw">=</span> <span class="st">"conversion_suggested"</span> )

<span class="co">## Metadata is harmonized to various classes, but mainly character.</span>
<span class="no">metadata_panel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_qb_vars.html">harmonize_qb_vars</a></span>(
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">my_survey_list</span>,
  <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">my_metadata</span>,
  <span class="kw">question_block</span> <span class="kw">=</span> <span class="st">"metadata"</span>,
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"var_name_suggested"</span>,
  <span class="kw">conversion</span> <span class="kw">=</span> <span class="st">"conversion_suggested"</span> )

<span class="co">## Demography panel is harmonized uniquely, but this is not well</span>
<span class="co">## developed yet.</span>
<span class="no">demography_panel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_qb_vars.html">harmonize_qb_vars</a></span>(
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">my_survey_list</span>,
  <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">my_metadata</span>,
  <span class="kw">id_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"uniqid"</span>, <span class="st">"doi"</span>),
  <span class="kw">question_block</span> <span class="kw">=</span> <span class="st">"socio-demography"</span>,
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"var_name_suggested"</span>,
  <span class="kw">conversion</span> <span class="kw">=</span> <span class="st">"conversion_suggested"</span> )</pre></body></html></div>
<div id="value-harmonization" class="section level3">
<h3 class="hasAnchor">
<a href="#value-harmonization" class="anchor"></a>Value Harmonization</h3>
<p>The trust panel contains harmonized labelled variables. They can be converted to a harmonized numeric value with consistent binary values and consistent treatment of <code>inappropriate</code> and <code>declined</code> values.</p>
<blockquote>
<p>This is only working with binary vars, the rest is converted to character.</p>
</blockquote>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">trust_panel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_qb_vars.html">harmonize_qb_vars</a></span>(
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">my_survey_list</span>,
  <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">my_metadata</span>,
  <span class="kw">question_block</span> <span class="kw">=</span> <span class="st">"trust"</span>,
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"var_name_suggested"</span>,
  <span class="kw">conversion</span> <span class="kw">=</span> <span class="st">"conversion_suggested"</span> )</pre></body></html></div>
<p>The <code>trust_vector</code> below contains the harmonized numeric values, harmonized labels alongside the original values and the original labels. This means that all conversion is <em>reversible</em>.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">trust_vector</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> ( <span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">trust_vector</span>)
<span class="co">#&gt;  dbl+lbl [1:5] 99998,     1,     0, 99999,    NA</span>
<span class="co">#&gt;  @ labels     : Named num [1:4] 99998 1 0 99999</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:4] "decline" "tend_to_trust" "tend_not_to_trust" "inap"</span>
<span class="co">#&gt;  @ labels_orig: Named num [1:4] 99998 1 0 99999</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:4] "DK" "Tend to trust" "Tend not to trust" "Inap. (not 1 in eu28)"</span>
<span class="co">#&gt;  @ num_orig   : Named num [1:4] 99998 1 0 99999</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:4] "3" "1" "2" "9"</span></pre></body></html></div>
<p>The <code><a href="../reference/harmonize_to_numeric.html">harmonize_to_numeric()</a></code> function correctly gives the numeric value, considering the two sources of missingness.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">trust_panel</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(-<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="st">"panel_id"</span>)), <span class="no">harmonize_to_numeric</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_if</a></span> ( <span class="no">is.numeric</span>, <span class="no">mean</span>, <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>( <span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
council_of_the_eu_trust
</td>
<td style="text-align:right;">
0.5603632
</td>
</tr>
<tr>
<td style="text-align:left;">
european_central_bank_trust
</td>
<td style="text-align:right;">
0.4880052
</td>
</tr>
<tr>
<td style="text-align:left;">
european_commission_trust
</td>
<td style="text-align:right;">
0.6032808
</td>
</tr>
<tr>
<td style="text-align:left;">
european_council_trust
</td>
<td style="text-align:right;">
0.5801233
</td>
</tr>
<tr>
<td style="text-align:left;">
european_parliament_trust
</td>
<td style="text-align:right;">
0.6386884
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_army
</td>
<td style="text-align:right;">
0.6897696
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_european_union
</td>
<td style="text-align:right;">
0.5148342
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_european_union_tcc
</td>
<td style="text-align:right;">
0.5376344
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_justice_legal_system
</td>
<td style="text-align:right;">
0.5038724
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_media
</td>
<td style="text-align:right;">
0.3939707
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_media_tcc
</td>
<td style="text-align:right;">
0.2600000
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_national_government
</td>
<td style="text-align:right;">
0.4133733
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_national_parliament
</td>
<td style="text-align:right;">
0.3929345
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_police
</td>
<td style="text-align:right;">
0.6622064
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_political_parties
</td>
<td style="text-align:right;">
0.2315917
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_political_partiess_tcc
</td>
<td style="text-align:right;">
0.1503268
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_public_administration
</td>
<td style="text-align:right;">
0.5322263
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_reg_local_public_authorities
</td>
<td style="text-align:right;">
0.5670477
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_united_nations
</td>
<td style="text-align:right;">
0.5674447
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_united_nations_tcc
</td>
<td style="text-align:right;">
0.5212187
</td>
</tr>
<tr>
<td style="text-align:left;">
trust_in_institutions_political_parties_tcc
</td>
<td style="text-align:right;">
0.1425577
</td>
</tr>
</tbody>
</table>
<p>It is likely that your computer’s memory will not be enough to <code>left_join</code> these data tables, so bind them in long format:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">panels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span> ( <span class="no">id_panel</span>,
                 <span class="no">trust_panel</span>,
                 <span class="no">demography_panel</span>,
                 <span class="no">weight_panel</span>,
                 <span class="no">metadata_panel</span>
                 )

<span class="no">long_panels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> (<span class="no">panels</span>,
                 <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span> (
                   <span class="no">x</span>, -<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="st">"panel_id"</span>) )
                )

<span class="no">panel_long</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(
  <span class="no">rbind</span>, <span class="no">long_panels</span> )

<span class="no">my_panel</span> <span class="kw">&lt;-</span> <span class="no">panel_long</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span> () <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span> ( <span class="no">id_panel</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">'panel_id'</span>  )</pre></body></html></div>
<p>The advantage of this workflow is that we can separately work on the <code>demography_panel</code>, <code>metadata_panel</code>, <code>trust_panel</code>.</p>
<p>The harmonize_qb in turn cares systematically for variables types, such as <em>multiple_choice_questions</em>, <em>two-level_factors</em>, <em>three-level_factors</em>, <em>numeric</em>, <em>character</em> for constants, etc.</p>
<p>This approach is not sensitive to missing questions. If some trust questions are present in all files, and others only in a few, you will still get a full panel.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Print the harmonized and the original value labels</span>
<span class="kw pkg">labelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/labelled/man/val_labels.html">val_labels</a></span>(<span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>)
<span class="co">#&gt;           decline     tend_to_trust tend_not_to_trust              inap </span>
<span class="co">#&gt;             99998                 1                 0             99999</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>, <span class="st">"labels_orig"</span>)
<span class="co">#&gt;                    DK         Tend to trust     Tend not to trust </span>
<span class="co">#&gt;                 99998                     1                     0 </span>
<span class="co">#&gt; Inap. (not 1 in eu28) </span>
<span class="co">#&gt;                 99999</span></pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Summarize them as factors</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> ( <span class="kw pkg">labelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/labelled/man/to_factor.html">to_factor</a></span>(<span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>))
<span class="co">#&gt;           decline     tend_to_trust tend_not_to_trust              inap </span>
<span class="co">#&gt;              1318              2098              1646              1517 </span>
<span class="co">#&gt;              NA's </span>
<span class="co">#&gt;              5789</span>
<span class="co"># Summarize them as numeric</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> ( <span class="fu"><a href="../reference/harmonize_to_numeric.html">harmonize_to_numeric</a></span>(<span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>))
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">#&gt;    0.00    0.00    1.00    0.56    1.00    1.00    8624</span></pre></body></html></div>
<p>You can simply revert to the original value labels:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="kw pkg">labelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/labelled/man/val_labels.html">val_labels</a></span>(
  <span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span> ) <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(
    <span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>, <span class="st">"labels_orig"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw pkg">labelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/labelled/man/to_factor.html">to_factor</a></span>(<span class="no">trust_panel</span>$<span class="no">council_of_the_eu_trust</span>))
<span class="co">#&gt;                    DK         Tend to trust     Tend not to trust </span>
<span class="co">#&gt;                  1318                  2098                  1646 </span>
<span class="co">#&gt; Inap. (not 1 in eu28)                  NA's </span>
<span class="co">#&gt;                  1517                  5789</span></pre></body></html></div>
</div>
<div id="work-documentation" class="section level2">
<h2 class="hasAnchor">
<a href="#work-documentation" class="anchor"></a>Work Documentation</h2>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">num_value_range</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">trust_panel</span>$<span class="no">trust_in_institutions_media</span>)
<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">num_value_range</span>)
<span class="co">#&gt; [1]     1 99998     0 99999    NA</span>
<span class="no">num_value_range</span> [!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">num_value_range</span>)]
<span class="co">#&gt; &lt;labelled&lt;double&gt;[4]&gt;</span>
<span class="co">#&gt; [1]     1 99998     0 99999</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Labels:</span>
<span class="co">#&gt;  value             label</span>
<span class="co">#&gt;      1     tend_to_trust</span>
<span class="co">#&gt;  99998           decline</span>
<span class="co">#&gt;      0 tend_not_to_trust</span>
<span class="co">#&gt;  99999              inap</span>

<span class="no">summarize_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> (
  <span class="kw">harmonized_numeric</span> <span class="kw">=</span> <span class="kw pkg">labelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/labelled/man/val_labels.html">val_labels</a></span>(
    <span class="no">trust_panel</span>$<span class="no">trust_in_institutions_media</span>),
    <span class="kw">original_numeric</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>( <span class="no">trust_panel</span>$<span class="no">trust_in_institutions_media</span>, <span class="st">"num_orig"</span>),
  <span class="kw">original_labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>( <span class="no">trust_panel</span>$<span class="no">trust_in_institutions_media</span>, <span class="st">"labels_orig"</span>))
)</pre></body></html></div>
<table class="table table table-striped table-hover table-condensed">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
harmonized_numeric
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
original_numeric
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
original_labels
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
tend_to_trust
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Tend to trust
</td>
</tr>
<tr>
<td style="text-align:left;">
decline
</td>
<td style="text-align:right;">
99998
</td>
<td style="text-align:right;">
99998
</td>
<td style="text-align:left;">
DK
</td>
</tr>
<tr>
<td style="text-align:left;">
tend_not_to_trust
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Tend not to trust
</td>
</tr>
<tr>
<td style="text-align:left;">
inap
</td>
<td style="text-align:right;">
99999
</td>
<td style="text-align:right;">
99999
</td>
<td style="text-align:left;">
Inap. (CY-TCC in isocntry)
</td>
</tr>
</tbody>
</table>
</div>
<div id="published-results" class="section level2">
<h2 class="hasAnchor">
<a href="#published-results" class="anchor"></a>Published results</h2>
<p>What I had been corresponding with GESIS is that from there we could have the following outputs:</p>
<ul>
<li><p>When we first finish a big batch, and include it in the panel, we create a trend file that will be published on GESIS, and it will be a separate data publication with its own doi. We can place it, for example, on <a href="https://zenodo.org/record/3759811#.XuYTKkUzbIU">Zenodo</a> or <a href="https://figshare.com/account/projects/80837/articles/12389384">figshare</a>, too.</p></li>
<li><p>We can also create a methodological publication from the standard steps we made</p></li>
<li><p>We can produce publications of the topical trend elements, probably with other researchers who know more about the topic, such as climate change.</p></li>
</ul>
<p>Therefore, we have the possibility to first exploit whatever we create, and the workflow remains transparent and reproducible. Other users can clear up other elements, and if they are good, we can ask them to join their part in as a contribution to the package.</p>
<ul>
<li>We can also see how much we are Eurobarometer-specific, and modify the package, or create a mutant for other surveys. I think we will not be very Eurobarometer specific.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
