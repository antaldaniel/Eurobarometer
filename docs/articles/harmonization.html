<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survey Data Harmonization • eurobarometer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Survey Data Harmonization">
<meta property="og:description" content="eurobarometer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eurobarometer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create_tabels.html">Creating Variable and Values Tables</a>
    </li>
    <li>
      <a href="../articles/eurobarometer_class.html">The labelled_eurobarometer Class</a>
    </li>
    <li>
      <a href="../articles/harmonization.html">Survey Data Harmonization</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Working With Metadata</a>
    </li>
    <li>
      <a href="../articles/variable_names.html">Harmonizing Variable Names</a>
    </li>
    <li>
      <a href="../articles/vocabulary.html">Working With Vocabularies</a>
    </li>
    <li>
      <a href="../articles/workflow.html">Workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/antaldaniel/eurobarometer/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="harmonization_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Survey Data Harmonization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antaldaniel/eurobarometer/blob/master/vignettes/harmonization.Rmd"><code>vignettes/harmonization.Rmd</code></a></small>
      <div class="hidden name"><code>harmonization.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">eurobarometer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)</pre></body></html></div>
<div id="class-conversion" class="section level2">
<h2 class="hasAnchor">
<a href="#class-conversion" class="anchor"></a>Class conversion</h2>
<p>We are using the SPSS file version of the GESIS archive and recommend reading in these files with the haven package. Haven uses a special R class, <code>labelled</code>, to preserve the metadata information of the SPSS file. While <code>labelled</code> provides a consistent and full representation of the SPSS file, it is not very useful for our purposes, because it mixes data with metadata in a way that is particular to the SPSS software.</p>
<p>The data part is not particularly useful for statistical analysis and visualization in the labelled class. We are looking for a practical representation of each typical questionnaire form: for example, multiple response questions are represented by indicator / dummy variables, and single choice questions can be usually represented with factors.</p>
<p>The metadata elements must be detached, harmonized and re-joined with the data. For example, multiple choice questions are almost always, but not always are coding per questionnaire item with two categories: <code>Mentioned</code> and <code>Not Mentioned</code>, with rare exceptions. We are re-coding them into numerical 1,0 values. Or, repeating single choice questions are sometimes differently ordered, or, apparently due to translation issues, are expressed with a different spelling or with a very similar synonym. If they are converted to factors, it is essential that the factor levels are matching in otherwise identical questionnaire items in different questionnaires.</p>
<p>###Harmonization of variable types In some cases, similar variables are represented with different type of data. For example, numerical information is sometimes described with words, such as One person, two persons, three persons. These must be brought to a consistent coding and variable type (class in R), i.e. they must be consistently either numeric or character variables.</p>
</div>
<div id="variable-names" class="section level2">
<h2 class="hasAnchor">
<a href="#variable-names" class="anchor"></a>Variable names</h2>
<p>Variable names are essential both for joining data from various surveys, and for programming. When we read in the SPSS file to a labelled class, we have a variable names and variable labels present from SPSS. Our primary goal is to harmonize the variable names, but we need to create a consistent mapping for variable names for potential cross-checking with actual questionnaires.</p>
<div id="harmonization-of-variable-names" class="section level3">
<h3 class="hasAnchor">
<a href="#harmonization-of-variable-names" class="anchor"></a>Harmonization of variable names</h3>
<p>The harmonization of variables means that the same variable name is used for the same questionnaire item. In the original GESIS files, there is a little consistency present, but not sufficient to use the original variable names. Some demography variables are consistently identified with their usual questionnaire item ID, for example, xxxx with xxxx. However, there seem to be exception. For non-trending, but potentially repeating policy questions, there are no harmonized variable names.</p>
<p>Another problem with the original variable names is that they are not always programmatically usable, because they use various reserved characters, such as percentage signs, semicolons, etc. We are changing them to ASCII-only, snake_form variable names that are harmonized. Harmonization of variable name labels.</p>
<p>The harmonization of variable name labels would mean that for each variable name, such as <code>type_of_community</code>, we would use the same generic question abbreviation xxxxxx. The harmonization of variable labels is not a priority, but the documentation of variant is an important task to create comprehensive data maps or metadata. While the generic questionnaire is always bilingual, i.e. English and French, it seems that sometimes it is a bit more English or bit more French, which leads to minor inconsistencies that are likely not systematically reflected in the actually used translations (and the final English language versions used in the United Kingdom and Ireland, and the final French versions used in France and Belgium.)</p>
<p>See more on variable name harmonization in <code><a href="../articles/metadata.html">vignette("metadata")</a></code> .</p>
</div>
</div>
<div id="harmonization-of-data" class="section level2">
<h2 class="hasAnchor">
<a href="#harmonization-of-data" class="anchor"></a>Harmonization of data</h2>
<p>Once we made sure that the <code>type_of_community</code> demography variable is called <code>type_of_community</code> in all data tables, and they are all converted to a character class, we can technically join tables with a time identifier to compare the contents of this variable. Conversion to character leads to a loss of information, because the answer options to this question are intended to be ordinal: they represent three levels of urbanizations irrespective of national administrative definitions.</p>
<p>Data harmonization means that the three levels are identically coded in the join.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"eurobarometer_corpus"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"eurobarometer"</span>)

<span class="no">eurobarometer_corpus</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> ( <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"town|rural"</span>, <span class="no">label_normalized</span> )) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span>(<span class="no">.</span>, <span class="fl">20</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="11%">
<col width="23%">
<col width="9%">
<col width="11%">
<col width="22%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">var_label_orig</th>
<th align="right">val_numeric_orig</th>
<th align="left">val_label_orig</th>
<th align="right">val_order_orig</th>
<th align="right">val_order_length</th>
<th align="left">label_normalized</th>
<th align="left">filename</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">p6</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA7483_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6cy</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6927_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6it</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6695_v1-1-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6hu</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA7482_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">d85.3</td>
<td align="right">1</td>
<td align="left">More medical staff in rural areas</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">more_medical_staff_in_rural_areas</td>
<td align="left">ZA7562_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">d25</td>
<td align="right">3</td>
<td align="left">Large town</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="left">large_town</td>
<td align="left">ZA6939_v2-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6pt</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6963_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">d25</td>
<td align="right">3</td>
<td align="left">Large town</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="left">large_town</td>
<td align="left">ZA5877_v2-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6bg</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA7488_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6dk</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA7482_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6nl</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6925_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6ro</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6963_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6hr</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA6963_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6fr</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA7483_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6it</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA6642_v4-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6pt</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA6928_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6it</td>
<td align="right">1</td>
<td align="left">Rural area</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">rural_area</td>
<td align="left">ZA6643_v4-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6dk</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6925_v1-0-0.sav</td>
</tr>
<tr class="odd">
<td align="left">p6at</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6963_v1-0-0.sav</td>
</tr>
<tr class="even">
<td align="left">p6cy</td>
<td align="right">2</td>
<td align="left">Towns and suburbs/ small urban area</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">towns_and_suburbs_small_urban_area</td>
<td align="left">ZA6925_v1-0-0.sav</td>
</tr>
</tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
