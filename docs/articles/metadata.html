<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working With Metadata • eurobarometer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working With Metadata">
<meta property="og:description" content="eurobarometer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eurobarometer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/harmonization.html">Survey Data Harmonization</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Working With Metadata</a>
    </li>
    <li>
      <a href="../articles/vocabulary.html">Working With Vocabularies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/antaldaniel/eurobarometer/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working With Metadata</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antaldaniel/eurobarometer/blob/master/vignettes/metadata.Rmd"><code>vignettes/metadata.Rmd</code></a></small>
      <div class="hidden name"><code>metadata.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">eurobarometer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)</pre></body></html></div>
<p>The <code>eb_sample</code> is a small fraction of the GESIS datafile <code>ZA5479_v6-0-0.sav</code>. It cannot be used to retrieve any statistical data from the original dataset. In scope it is limited to some important metadata columns, a few demographic variables and one question block. In geographic coverage, it takes a sample from the responses from the United Kingdom and Germany. These two countries are targeting parts of the countries separately, i.e. for Great Britain and Northern Ireland, and the former West Germany and East Germany.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">sample</span> <span class="kw">&lt;-</span> <span class="kw pkg">eurobarometer</span><span class="kw ns">:::</span><span class="no">eb_sample</span>
<span class="no">sample_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gesis_metadata_create.html">gesis_metadata_create</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">sample</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sample_metadata</span>)
<span class="co">#&gt; [1] "r_name"                "r_class"               "spss_name"            </span>
<span class="co">#&gt; [4] "normalized_names"      "factor_levels"         "level_length"         </span>
<span class="co">#&gt; [7] "conversion_suggestion"</span></pre></body></html></div>
<p>The function <code>gesis_metadta_create</code> normalizes those variable names that are not machine readable. These names are still often problematic and require adjustment.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">adjusted_metadata</span> <span class="kw">&lt;-</span> <span class="no">sample_metadata</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> ( <span class="kw">canonical_names</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span> (
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">normalized_names</span>, <span class="fl">1</span>,<span class="fl">3</span>) <span class="kw">==</span> <span class="st">"p6_|p7_"</span> ~ <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">normalized_names</span>, <span class="fl">4</span>,-<span class="fl">1</span>),
    <span class="no">normalized_names</span> <span class="kw">==</span> <span class="st">"w1_weight_result_from_target"</span> ~ <span class="st">'w1'</span>,
    <span class="fl">TRUE</span> ~ <span class="no">normalized_names</span>
  ))</pre></body></html></div>
<p>You can, if you know what you are doing, change the suggested base R representation of your survey data in the column:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">renamed_sample</span> <span class="kw">&lt;-</span> <span class="no">sample</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span> ( <span class="no">adjusted_metadata</span>$<span class="no">canonical_names</span>)

<span class="no">converted</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/convert_class.html">convert_class</a></span> (<span class="kw">dat</span> <span class="kw">=</span> <span class="no">renamed_sample</span>,
               <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">adjusted_metadata</span>,
               <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"canonical_names"</span>,
               <span class="kw">conversion</span> <span class="kw">=</span> <span class="st">"conversion_suggestion"</span>)

<span class="no">converted</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"w1"</span>,
                          <span class="st">"age_exact"</span>,
                          <span class="st">"is_energy_saving_action_used_car_less"</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span>(<span class="no">.</span>, <span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">w1</th>
<th align="left">age_exact</th>
<th align="right">is_energy_saving_action_used_car_less</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.6231</td>
<td align="left">64</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.6320</td>
<td align="left">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1.3963</td>
<td align="left">51</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0.6987</td>
<td align="left">30</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.5503</td>
<td align="left">19</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1.3067</td>
<td align="left">20</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.8873</td>
<td align="left">33</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0.7121</td>
<td align="left">66</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0.6085</td>
<td align="left">65</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1.3956</td>
<td align="left">52</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><code>GESIS</code> and/or <code>TNS</code> did not use some variable names consistently over the years and decades. Canonizing these variables names is a subjective matter. A subjective canonization is coded in ’canonical_names()`, which uses both the variable names and their labels from the SPSS file.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">sample_metadata</span>$<span class="no">canonical_names</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/canonical_names.html">canonical_names</a></span>(<span class="no">sample_metadata</span>)

<span class="no">sample</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span> ( <span class="no">sample_metadata</span>$<span class="no">canonical_names</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"age"</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span>(<span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">age_education</th>
<th align="right">age_education_recoded</th>
<th align="right">age_exact</th>
<th align="right">age_rec_4</th>
<th align="right">age_rec_6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">27</td>
<td align="right">9</td>
<td align="right">43</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">3</td>
<td align="right">23</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">1</td>
<td align="right">80</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">17</td>
<td align="right">4</td>
<td align="right">69</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">6</td>
<td align="right">55</td>
<td align="right">4</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">17</td>
<td align="right">4</td>
<td align="right">53</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">6</td>
<td align="right">53</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">3</td>
<td align="right">46</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">3</td>
<td align="right">48</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">3</td>
<td align="right">74</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
